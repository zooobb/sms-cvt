# 短信过滤应用优化计划

## 任务1：优化已保存短信列表展示
- 修改 `saved_messages_screen.dart` 的 `_MessageCard` 组件
- 在卡片中新增短信内容预览（截取前50-80字符）
- 确保二级分类信息清晰显示（已实现，需验证）

## 任务2：验证本地数据持久化存储
- 验证 SharedPreferences 存储的配置和分类映射完整性
- 确认文件存储的短信数据持久化机制
- 如有缺失，补充相关存储逻辑

## 任务3：优化短信分类匹配机制
- 在 `SavedSmsMessage` 模型中添加 `isManuallyClassified` 标识字段
- 修改 `storage_service.dart` 的 `addMessage` 方法：
  - 检查是否为手动分类（通过标识或检查 primaryCategory != '待分类'）
  - 手动分类的短信不参与自动分类匹配
  - 仅对未手动分类的短信执行自动分类

## 任务4：改进数据导出功能
- 修改 `storage_service.dart` 的 `exportToJson` 方法：
  - 对消息列表按 `receivedAt` 字段倒序排序
  - 添加时间格式化工具方法，统一格式为 "yyyy-MM-dd HH:mm:ss"
  - 格式化所有时间字段（receivedAt、savedAt、exportedAt）

## 任务5：完善二级分类展示
- 验证列表卡片中二级分类的显示逻辑
- 确保导出的JSON数据包含 `secondaryCategory` 字段
- 优化二级分类的UI展示样式

## 技术要点
- 遵循项目代码规范（Dart命名、Provider模式、Material 3）
- 使用中文注释
- 保持数据模型的一致性（toJson/fromJson/copyWith）
- 确保UI/UX的一致性（颜色、间距、圆角）